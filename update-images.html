<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –∏ –∫–æ–¥–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2a5298;
            border-bottom: 2px solid #2a5298;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #1e3c72;
            margin-top: 0;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .player-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .player-card {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            background: white;
            transition: transform 0.2s;
        }
        
        .player-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .player-card img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid #2a5298;
        }
        
        button {
            background: #2a5298;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: background 0.2s;
        }
        
        button:hover {
            background: #1e3c72;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            margin: 2px;
        }
        
        .danger {
            background: #dc3545;
        }
        
        .danger:hover {
            background: #c82333;
        }
        
        .success {
            background: #28a745;
        }
        
        .success:hover {
            background: #218838;
        }
        
        input[type="text"], input[type="file"], select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            font-family: 'Courier New', monospace;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            align-items: center;
        }
        
        .form-row input {
            flex: 1;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .firebase-status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .firebase-connected {
            background: #d4edda;
            color: #155724;
        }
        
        .firebase-disconnected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 10px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #2a5298;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2a5298;
        }
        
        .search-box {
            margin: 15px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .json-format {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            border: 1px solid #dee2e6;
        }
        
        .toggle-button {
            background: #6c757d;
            font-size: 12px;
            padding: 5px 10px;
        }
        
        .hidden-content {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öôÔ∏è –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–æ–ª–µ–π–±–æ–ª—å–Ω—ã–º –∫–ª—É–±–æ–º</h1>
        
        <!-- –°—Ç–∞—Ç—É—Å Firebase -->
        <div id="firebase-status" class="firebase-status firebase-disconnected">
            üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Firebase...
        </div>
        
        <!-- –°—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ü–∏–π -->
        <div id="status" class="status"></div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ -->
        <div class="section" id="stats-section">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞</h2>
            <div id="project-stats" class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="players-count">0</div>
                    <div>–ò–≥—Ä–æ–∫–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="teams-count">0</div>
                    <div>–ö–æ–º–∞–Ω–¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="matches-count">0</div>
                    <div>–ú–∞—Ç—á–µ–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="users-count">0</div>
                    <div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
            </div>
        </div>
        
        <!-- –†–∞–∑–¥–µ–ª 1: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏ -->
        <div class="section">
            <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏</h2>
            
            <!-- –ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–æ–≤ -->
            <div class="search-box">
                <input type="text" id="search-player" placeholder="üîç –ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∏–º–µ–Ω–∏..." 
                       onkeyup="searchPlayers()" style="width: 100%;">
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ -->
            <div id="players-container">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–æ–≤...</p>
            </div>
            
            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏ -->
            <div class="card">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞</h3>
                <div class="form-row">
                    <input type="text" id="player-name" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω)">
                    <input type="text" id="player-photo" placeholder="URL –∏–ª–∏ –ø—É—Ç—å –∫ —Ñ–æ—Ç–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: images/ivanov.png)">
                    <button onclick="addNewPlayer()" class="success">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
                <p><small>–ü—Ä–∏–º–µ—Ä—ã –ø—É—Ç–µ–π: images/–ê–∫–∞—Ä–æ –î–º–∏—Ç—Ä–∏–π.png, images/player1.jpg, https://example.com/photo.jpg</small></p>
            </div>
            
            <!-- –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ -->
            <div class="card">
                <h3>–ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤</h3>
                <p>–í–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: "–ò–º—è –§–∞–º–∏–ª–∏—è, image.png" (–ø–æ –æ–¥–Ω–æ–º—É –≤ —Å—Ç—Ä–æ–∫–µ)</p>
                <textarea id="bulk-players" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä:
–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω, images/ivanov.png
–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä, images/petrov.png
–°–∏–¥–æ—Ä–æ–≤ –°–∏–¥–æ—Ä, images/sidorov.png"></textarea>
                <button onclick="addBulkPlayers()" class="success">–î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ—Ö</button>
                <button onclick="toggleJsonFormat()" class="toggle-button">–ü–æ–∫–∞–∑–∞—Ç—å JSON —Ñ–æ—Ä–º–∞—Ç</button>
                
                <div id="json-format-help" class="hidden-content">
                    <p><strong>–§–æ—Ä–º–∞—Ç JSON –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞:</strong></p>
                    <div class="json-format">
[
  {
    "name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω",
    "photo": "images/ivanov.png"
  },
  {
    "name": "–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä",
    "photo": "images/petrov.png"
  }
]
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –†–∞–∑–¥–µ–ª 2: –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç -->
        <div class="section">
            <h2>üì§ –≠–∫—Å–ø–æ—Ä—Ç / üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
            
            <div class="stats-grid">
                <div class="card">
                    <h3>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                    <p>–°–∫–∞—á–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON</p>
                    <button onclick="exportPlayersJSON()">–≠–∫—Å–ø–æ—Ä—Ç –∏–≥—Ä–æ–∫–æ–≤</button>
                    <button onclick="exportTeamsJSON()">–≠–∫—Å–ø–æ—Ä—Ç –∫–æ–º–∞–Ω–¥</button>
                    <button onclick="exportMatchesJSON()">–≠–∫—Å–ø–æ—Ä—Ç –º–∞—Ç—á–µ–π</button>
                    <button onclick="exportAllData()" class="success">–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ–≥–æ</button>
                </div>
                
                <div class="card">
                    <h3>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                    <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ JSON —Ñ–∞–π–ª–∞</p>
                    <input type="file" id="import-file" accept=".json" style="margin: 10px 0;">
                    <select id="import-type" style="margin: 10px 0;">
                        <option value="players">–ò–≥—Ä–æ–∫–∏</option>
                        <option value="teams">–ö–æ–º–∞–Ω–¥—ã</option>
                        <option value="matches">–ú–∞—Ç—á–∏</option>
                        <option value="all">–í—Å–µ –¥–∞–Ω–Ω—ã–µ</option>
                    </select>
                    <button onclick="importData()" class="success">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <p><small>–î—É–±–ª–∏–∫–∞—Ç—ã –∏–≥—Ä–æ–∫–æ–≤ (–ø–æ –∏–º–µ–Ω–∏) –Ω–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã</small></p>
                </div>
            </div>
        </div>
        
        <!-- –†–∞–∑–¥–µ–ª 3: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ -->
        <div class="section">
            <h2>üõ† –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</h2>
            
            <div class="stats-grid">
                <div class="card">
                    <h3>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                    <button onclick="addDefaultPlayers()">–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
                    <button onclick="addTestPlayer()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞</button>
                    <button onclick="clearAllPlayers()" class="danger">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤</button>
                </div>
                
                <div class="card">
                    <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h3>
                    <button onclick="checkConnection()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
                    <button onclick="testImagePaths()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Ç–∏ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º</button>
                    <button onclick="showDuplicates()">–ù–∞–π—Ç–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã</button>
                </div>
                
                <div class="card">
                    <h3>–ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏</h3>
                    <button onclick="window.open('index.html', '_blank')">–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
                    <button onclick="window.open('https://github.com/your-repo', '_blank')">GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</button>
                </div>
            </div>
        </div>
        
        <!-- –†–∞–∑–¥–µ–ª 4: –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ -->
        <div class="section">
            <h2>üíª –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞</h2>
            
            <div class="stats-grid">
                <div class="card">
                    <h3>–§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞</h3>
                    <button onclick="loadFile('index.html')">index.html</button>
                    <button onclick="loadFile('styles.css')">styles.css</button>
                    <button onclick="loadFile('script.js')">script.js</button>
                    <button onclick="loadFile('firebase-config.js')">firebase-config.js</button>
                </div>
                
                <div class="card">
                    <h3>–†–µ–¥–∞–∫—Ç–æ—Ä</h3>
                    <input type="text" id="filename" placeholder="–ò–º—è —Ñ–∞–π–ª–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è">
                    <textarea id="code-editor" placeholder="–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞..."></textarea>
                    <button onclick="saveFile()" class="success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB8VVVRRAFUImUY7xNU5P1_HYmqGrK5JKSo",
            authDomain: "volleyball-club-709.firebaseapp.com",
            projectId: "volleyball-club-709",
            storageBucket: "volleyball-club-709.firebasestorage.app",
            messagingSenderId: "295552333871",
            appId: "1:295552333871:web:3da98ba1e8a7bff48f6eda",
            measurementId: "G-ESTC6PDVG1"
        };
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let firebaseInitialized = false;
        let db = null;
        let allPlayers = [];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        function initFirebase() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                db = firebase.firestore();
                firebaseInitialized = true;
                
                updateFirebaseStatus(true, '‚úÖ Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω');
                loadAllData();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:', error);
                updateFirebaseStatus(false, `‚ùå –û—à–∏–±–∫–∞ Firebase: ${error.message}`);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ Firebase
        function updateFirebaseStatus(connected, message) {
            const statusElement = document.getElementById('firebase-status');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.className = `firebase-status ${connected ? 'firebase-connected' : 'firebase-disconnected'}`;
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            if (status) {
                status.textContent = message;
                status.className = `status status-${type}`;
                status.style.display = 'block';
                
                setTimeout(() => {
                    status.style.display = 'none';
                }, 5000);
            }
            console.log(`${type}: ${message}`);
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
        async function loadAllData() {
            if (!firebaseInitialized) return;
            
            await Promise.all([
                loadPlayers(),
                loadStats()
            ]);
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤
        async function loadPlayers() {
            if (!firebaseInitialized) return;
            
            try {
                const snapshot = await db.collection('players').get();
                allPlayers = [];
                
                snapshot.forEach(doc => {
                    allPlayers.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                displayPlayers(allPlayers);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤:', error);
                showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤', 'error');
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤
        function displayPlayers(players) {
            const container = document.getElementById('players-container');
            if (!container) return;
            
            if (players.length === 0) {
                container.innerHTML = '<p>–ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</p>';
                return;
            }
            
            let html = `
                <div style="margin-bottom: 15px; color: #666;">
                    –ù–∞–π–¥–µ–Ω–æ –∏–≥—Ä–æ–∫–æ–≤: ${players.length}
                </div>
                <div class="player-grid">
            `;
            
            players.forEach(player => {
                const photoUrl = player.photo || 'images/default-player.png';
                const shortId = player.id ? player.id.substring(0, 8) : '–Ω–æ–≤—ã–π';
                
                html += `
                    <div class="player-card">
                        <img src="${photoUrl}" 
                             alt="${player.name}"
                             onerror="this.src='images/default-player.png'">
                        <p><strong>${player.name}</strong></p>
                        <p style="font-size: 12px; color: #666;">ID: ${shortId}...</p>
                        <div style="margin-top: 10px;">
                            <button onclick="editPlayer('${player.id}')" class="btn-small">‚úèÔ∏è</button>
                            <button onclick="deletePlayer('${player.id}')" class="btn-small danger">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // –ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–æ–≤
        function searchPlayers() {
            const searchTerm = document.getElementById('search-player').value.toLowerCase();
            
            if (!searchTerm) {
                displayPlayers(allPlayers);
                return;
            }
            
            const filteredPlayers = allPlayers.filter(player => 
                player.name.toLowerCase().includes(searchTerm)
            );
            
            displayPlayers(filteredPlayers);
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        async function addNewPlayer() {
            if (!firebaseInitialized) {
                showStatus('Firebase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                return;
            }
            
            const name = document.getElementById('player-name').value.trim();
            const photo = document.getElementById('player-photo').value.trim();
            
            if (!name) {
                showStatus('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ –∏–≥—Ä–æ–∫–∞ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º
            const existingPlayer = allPlayers.find(p => 
                p.name.toLowerCase() === name.toLowerCase()
            );
            
            if (existingPlayer) {
                showStatus(`–ò–≥—Ä–æ–∫ "${name}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!`, 'error');
                return;
            }
            
            try {
                await db.collection('players').add({
                    name: name,
                    photo: photo || 'images/default-player.png',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
                
                showStatus(`–ò–≥—Ä–æ–∫ "${name}" –¥–æ–±–∞–≤–ª–µ–Ω`);
                loadAllData();
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
                document.getElementById('player-name').value = '';
                document.getElementById('player-photo').value = '';
                
            } catch (error) {
                showStatus(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤
        async function addBulkPlayers() {
            if (!firebaseInitialized) {
                showStatus('Firebase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                return;
            }
            
            const bulkText = document.getElementById('bulk-players').value.trim();
            if (!bulkText) {
                showStatus('–í–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤', 'error');
                return;
            }
            
            const lines = bulkText.split('\n').filter(line => line.trim());
            let added = 0;
            let skipped = 0;
            let errors = 0;
            
            showStatus(`–û–±—Ä–∞–±–æ—Ç–∫–∞ ${lines.length} –∏–≥—Ä–æ–∫–æ–≤...`, 'success');
            
            for (const line of lines) {
                try {
                    const [name, photo] = line.split(',').map(s => s.trim());
                    
                    if (!name) {
                        errors++;
                        continue;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç
                    const existingPlayer = allPlayers.find(p => 
                        p.name.toLowerCase() === name.toLowerCase()
                    );
                    
                    if (existingPlayer) {
                        skipped++;
                        continue;
                    }
                    
                    await db.collection('players').add({
                        name: name,
                        photo: photo || 'images/default-player.png',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                    
                    added++;
                    
                } catch (error) {
                    errors++;
                    console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞:', error);
                }
            }
            
            showStatus(`–î–æ–±–∞–≤–ª–µ–Ω–æ: ${added}, –ü—Ä–æ–ø—É—â–µ–Ω–æ (–¥—É–±–ª–∏–∫–∞—Ç—ã): ${skipped}, –û—à–∏–±–æ–∫: ${errors}`, 'success');
            loadAllData();
        }
        
        // –£–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞
        async function deletePlayer(playerId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞?')) return;
            
            try {
                await db.collection('players').doc(playerId).delete();
                showStatus('–ò–≥—Ä–æ–∫ —É–¥–∞–ª–µ–Ω');
                loadAllData();
            } catch (error) {
                showStatus(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä–æ–∫–∞
        async function editPlayer(playerId) {
            const player = allPlayers.find(p => p.id === playerId);
            if (!player) return;
            
            const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è:', player.name);
            if (!newName || newName === player.name) return;
            
            const newPhoto = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π URL —Ñ–æ—Ç–æ:', player.photo || '');
            
            try {
                const updateData = {
                    name: newName,
                    updatedAt: new Date().toISOString()
                };
                
                if (newPhoto !== null) {
                    updateData.photo = newPhoto;
                }
                
                await db.collection('players').doc(playerId).update(updateData);
                showStatus('–ò–≥—Ä–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω');
                loadAllData();
            } catch (error) {
                showStatus(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        async function addDefaultPlayers() {
            const defaultPlayers = [
                { name: "–ê–∫–∞—Ä–æ –î–º–∏—Ç—Ä–∏–π", photo: "images/–ê–∫–∞—Ä–æ –î–º–∏—Ç—Ä–∏–π.png" },
                { name: "–ë–∞–ª–∞–≥–¥–∏–Ω –ú–∞–∫—Å–∏–º", photo: "images/–ë–∞–ª–∞–≥–¥–∏–Ω –ú–∞–∫—Å–∏–º.png" },
                { name: "–ë–∞—Ä–∏–Ω–æ–≤–∞ –ê—Ä–∏–Ω–∞", photo: "images/–ë–∞—Ä–∏–Ω–æ–≤–∞ –ê—Ä–∏–Ω–∞.png" },
                { name: "–ë–∞—Ä–∞—á–µ–≤ –ê—Ä—Ç—ë–º", photo: "images/–ë–∞—Ä–∞—á–µ–≤ –ê—Ä—Ç—ë–º.png" },
                { name: "–ï–≤–≥–µ–Ω–∏–π –ö–æ–ª–µ—Å–Ω–∏–∫–æ–≤", photo: "images/–ï–≤–≥–µ–Ω–∏–π –ö–æ–ª–µ—Å–Ω–∏–∫–æ–≤.png" },
                { name: "–ó–∞–π—Ü–µ–≤ –°–µ—Ä–≥–µ–π", photo: "images/–ó–∞–π—Ü–µ–≤ –°–µ—Ä–≥–µ–π.png" },
                { name: "–ó–∞—Ç–æ–ª–æ–∫–∞ –ú–∞—Ç–≤–µ–π", photo: "images/–ó–∞—Ç–æ–ª–æ–∫–∞ –ú–∞—Ç–≤–µ–π.png" },
                { name: "–ö–∞–±–∞–Ω–æ–≤ –ú–∞–∫–∞—Ä", photo: "images/–ö–∞–±–∞–Ω–æ–≤ –ú–∞–∫–∞—Ä.png" },
                { name: "–ö–∞–ª–∞—à–∏–Ω –§—ë–¥–æ—Ä", photo: "images/–ö–∞–ª–∞—à–∏–Ω –§—ë–¥–æ—Ä.png" },
                { name: "–ö–æ–º–∞—Ä–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä", photo: "images/–ö–æ–º–∞—Ä–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä.png" }
            ];
            
            let added = 0;
            let skipped = 0;
            
            for (const playerData of defaultPlayers) {
                try {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç
                    const existingPlayer = allPlayers.find(p => 
                        p.name.toLowerCase() === playerData.name.toLowerCase()
                    );
                    
                    if (existingPlayer) {
                        skipped++;
                        continue;
                    }
                    
                    await db.collection('players').add({
                        ...playerData,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                    
                    added++;
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞:', error);
                }
            }
            
            showStatus(`–î–æ–±–∞–≤–ª–µ–Ω–æ: ${added}, –ü—Ä–æ–ø—É—â–µ–Ω–æ (–¥—É–±–ª–∏–∫–∞—Ç—ã): ${skipped}`, 'success');
            loadAllData();
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        async function addTestPlayer() {
            await addNewPlayerWithName('–¢–µ—Å—Ç–æ–≤—ã–π –ò–≥—Ä–æ–∫ ' + Date.now().toString().slice(-4));
        }
        
        async function addNewPlayerWithName(name) {
            if (!firebaseInitialized) return;
            
            try {
                await db.collection('players').add({
                    name: name,
                    photo: 'images/default-player.png',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
                
                showStatus(`–¢–µ—Å—Ç–æ–≤—ã–π –∏–≥—Ä–æ–∫ "${name}" –¥–æ–±–∞–≤–ª–µ–Ω`);
                loadAllData();
            } catch (error) {
                showStatus(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
        async function clearAllPlayers() {
            if (!confirm('–í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª–∏—Ç—å –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;
            
            try {
                const snapshot = await db.collection('players').get();
                
                if (snapshot.empty) {
                    showStatus('–ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                    return;
                }
                
                const batch = db.batch();
                snapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                await batch.commit();
                showStatus(`–£–¥–∞–ª–µ–Ω–æ ${snapshot.size} –∏–≥—Ä–æ–∫–æ–≤`);
                loadAllData();
                
            } catch (error) {
                showStatus(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –∏–≥—Ä–æ–∫–æ–≤ –≤ JSON
        async function exportPlayersJSON() {
            try {
                const data = allPlayers.map(p => ({
                    name: p.name,
                    photo: p.photo || 'images/default-player.png'
                }));
                
                downloadJSON(data, 'players_export.json');
                showStatus(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${data.length} –∏–≥—Ä–æ–∫–æ–≤`);
                
            } catch (error) {
                showStatus(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${error.message}`, 'error');
            }
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        async function exportAllData() {
            try {
                const [playersSnap, teamsSnap, matchesSnap] = await Promise.all([
                    db.collection('players').get(),
                    db.collection('teams').get(),
                    db.collection('matches').get()
                ]);
                
                const data = {
                    players: playersSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    teams: teamsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    matches: matchesSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    exportDate: new Date().toISOString(),
                    total: {
                        players: playersSnap.size,
                        teams: teamsSnap.size,
                        matches: matchesSnap.size
                    }
                };
                
                downloadJSON(data, 'volleyball_club_full_export.json');
                showStatus(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö`);
                
            } catch (error) {
                showStatus(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${error.message}`, 'error');
            }
        }
        
        // –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        async function importData() {
            const fileInput = document.getElementById('import-file');
            const importType = document.getElementById('import-type').value;
            
            if (!fileInput.files.length) {
                showStatus('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = async (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    let imported = 0;
                    let skipped = 0;
                    
                    if (importType === 'players' || importType === 'all') {
                        const players = Array.isArray(data) ? data : data.players || [];
                        
                        for (const player of players) {
                            if (!player.name) continue;
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç
                            const existingPlayer = allPlayers.find(p => 
                                p.name.toLowerCase() === player.name.toLowerCase()
                            );
                            
                            if (existingPlayer) {
                                skipped++;
                                continue;
                            }
                            
                            await db.collection('players').add({
                                name: player.name,
                                photo: player.photo || 'images/default-player.png',
                                createdAt: new Date().toISOString(),
                                updatedAt: new Date().toISOString()
                            });
                            
                            imported++;
                        }
                    }
                    
                    showStatus(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${imported}, –ü—Ä–æ–ø—É—â–µ–Ω–æ (–¥—É–±–ª–∏–∫–∞—Ç—ã): ${skipped}`, 'success');
                    loadAllData();
                    
                } catch (error) {
                    showStatus(`–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ${error.message}`, 'error');
                }
            };
            
            reader.readAsText(file);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStats() {
            if (!firebaseInitialized) return;
            
            try {
                const [playersSnap, teamsSnap, matchesSnap, usersSnap] = await Promise.all([
                    db.collection('players').get(),
                    db.collection('teams').get(),
                    db.collection('matches').get(),
                    db.collection('users').get()
                ]);
                
                document.getElementById('players-count').textContent = playersSnap.size;
                document.getElementById('teams-count').textContent = teamsSnap.size;
                document.getElementById('matches-count').textContent = matchesSnap.size;
                document.getElementById('users-count').textContent = usersSnap.size;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        async function checkConnection() {
            try {
                await db.collection('players').limit(1).get();
                showStatus('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
            } catch (error) {
                showStatus('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Ç–µ–π –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
        async function testImagePaths() {
            const testImages = allPlayers.map(p => p.photo).filter(p => p);
            let valid = 0;
            let invalid = 0;
            
            showStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Ç–µ–π –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º...', 'success');
            
            for (const imgUrl of testImages) {
                try {
                    const response = await fetch(imgUrl, { method: 'HEAD' });
                    if (response.ok) {
                        valid++;
                    } else {
                        invalid++;
                    }
                } catch {
                    invalid++;
                }
            }
            
            showStatus(`–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${testImages.length}, –î–æ—Å—Ç—É–ø–Ω–æ: ${valid}, –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ: ${invalid}`, 'success');
        }
        
        // –ù–∞–π—Ç–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã
        function showDuplicates() {
            const duplicates = [];
            const seen = new Set();
            
            allPlayers.forEach(player => {
                const key = player.name.toLowerCase();
                if (seen.has(key)) {
                    duplicates.push(player.name);
                } else {
                    seen.add(key);
                }
            });
            
            if (duplicates.length === 0) {
                showStatus('–î—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'success');
            } else {
                showStatus(`–ù–∞–π–¥–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã: ${duplicates.join(', ')}`, 'error');
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function downloadJSON(data, filename) {
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
            
            URL.revokeObjectURL(url);
        }
        
        function toggleJsonFormat() {
            const helpDiv = document.getElementById('json-format-help');
            helpDiv.style.display = helpDiv.style.display === 'block' ? 'none' : 'block';
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫–æ–¥–∞
        async function loadFile(filename) {
            try {
                const response = await fetch(filename);
                if (!response.ok) throw new Error('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
                
                const text = await response.text();
                document.getElementById('code-editor').value = text;
                document.getElementById('filename').value = filename;
                
                showStatus(`–§–∞–π–ª "${filename}" –∑–∞–≥—Ä—É–∂–µ–Ω`);
            } catch (error) {
                showStatus(`–§–∞–π–ª "${filename}" –Ω–µ –Ω–∞–π–¥–µ–Ω`, 'error');
            }
        }
        
        async function saveFile() {
            const filename = document.getElementById('filename').value.trim();
            const content = document.getElementById('code-editor').value;
            
            if (!filename) {
                showStatus('–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞', 'error');
                return;
            }
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
            
            URL.revokeObjectURL(url);
            showStatus(`–§–∞–π–ª "${filename}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω`);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', initFirebase);
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        window.addNewPlayer = addNewPlayer;
        window.addBulkPlayers = addBulkPlayers;
        window.addDefaultPlayers = addDefaultPlayers;
        window.addTestPlayer = addTestPlayer;
        window.deletePlayer = deletePlayer;
        window.editPlayer = editPlayer;
        window.clearAllPlayers = clearAllPlayers;
        window.exportPlayersJSON = exportPlayersJSON;
        window.exportAllData = exportAllData;
        window.importData = importData;
        window.checkConnection = checkConnection;
        window.testImagePaths = testImagePaths;
        window.showDuplicates = showDuplicates;
        window.searchPlayers = searchPlayers;
        window.toggleJsonFormat = toggleJsonFormat;
        window.loadFile = loadFile;
        window.saveFile = saveFile;
    </script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
</body>
</html>